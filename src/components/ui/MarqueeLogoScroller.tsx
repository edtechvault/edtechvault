'use client';

import React from 'react';
import { cn } from '@/lib/utils';

// Define the type for individual logo props
interface Logo {
  src: string;
  alt: string;
  gradient: {
    from: string;
    via: string;
    to: string;
  };
}

// Define the props for the main component
interface MarqueeLogoScrollerProps extends React.HTMLAttributes<HTMLDivElement> {
  title: string;
  description: string;
  logos: Logo[];
  speed?: 'normal' | 'slow' | 'fast';
}

/**
 * A responsive, self-contained, and infinitely scrolling marquee component.
 * It pauses on hover and uses shadcn/ui theme variables for styling.
 * This component includes its own CSS animation and does not require tailwind.config.js modifications.
 */
const MarqueeLogoScroller = React.forwardRef<HTMLDivElement, MarqueeLogoScrollerProps>(
  ({ title, description, logos, speed = 'normal', className, ...props }, ref) => {
    // Map speed prop to animation duration
    const durationMap = {
      normal: '40s',
      slow: '80s',
      fast: '20s',
    };
    const animationDuration = durationMap[speed];

    return (
      <>
        {/* The @keyframes for the marquee animation are defined directly here for robustness. */}
        <style>{`
          @keyframes marquee {
            from {
              transform: translateX(0);
            }
            to {
              transform: translateX(-50%);
            }
          }
        `}</style>

        <section
          ref={ref}
          aria-label={title}
          className={cn(
            'w-full bg-[var(--secondary)] text-[var(--text-primary)] rounded-lg border border-[var(--border)] overflow-hidden',
            className
          )}
          {...props}
        >
          {/* Header Section */}
          <div className="p-6 md:p-8 lg:p-10">
            <div className="grid grid-cols-1 lg:grid-cols-[3fr_2fr] gap-6 lg:gap-8 pb-6 md:pb-8 border-b border-[var(--primary)]/10">
              <h2 className="font-heading font-semibold text-3xl md:text-4xl tracking-tighter text-balance">
                {title}
              </h2>
              <p className="text-[var(--text-secondary)] self-start lg:justify-self-end text-lg text-balance">
                {description}
              </p>
            </div>
          </div>

          {/* Marquee Section */}
          <div
            className="w-full overflow-hidden"
            style={{
              maskImage:
                'linear-gradient(to right, transparent, black 10%, black 90%, transparent)',
            }}
          >
            <div
              className="flex w-max items-start gap-6 py-6 pr-6 hover:[animation-play-state:paused] transition-all duration-300 ease-in-out"
              style={{
                animation: `marquee ${animationDuration} linear infinite`,
              }}
            >
              {/* Render logos twice to create a seamless loop */}
              {[...logos, ...logos].map((logo, index) => (
                <div
                  key={index}
                  className="group shrink-0 flex flex-col items-center gap-3"
                >
                  {/* Logo Card */}
                  <div className="relative h-24 w-40 flex items-center justify-center rounded-lg bg-[var(--background-white)] overflow-hidden">
                    {/* Gradient background revealed on hover */}
                    <div
                      style={
                        {
                          '--from': logo.gradient.from,
                          '--via': logo.gradient.via,
                          '--to': logo.gradient.to,
                        } as React.CSSProperties
                      }
                      className="absolute inset-0 scale-150 opacity-0 transition-all duration-700 ease-out group-hover:opacity-100 group-hover:scale-100 bg-gradient-to-br from-[var(--from)] via-[var(--via)] to-[var(--to)]"
                    />

                    {/* Logo Image */}
                    <img
                      src={logo.src}
                      alt={logo.alt}
                      className="h-8 w-auto object-contain"
                    />
                  </div>

                  {/* Logo Name */}
                  <span className="text-sm font-medium text-[var(--text-secondary)] group-hover:text-[var(--text-primary)] transition-colors duration-300">
                    {logo.alt}
                  </span>
                </div>
              ))}
            </div>
          </div>
        </section>
      </>
    );
  }
);

MarqueeLogoScroller.displayName = 'MarqueeLogoScroller';

export { MarqueeLogoScroller };
export type { Logo, MarqueeLogoScrollerProps };
